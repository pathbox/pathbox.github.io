---
layout: post
title: 最近工作总结(43)
date:  2020-11-05 20:15:06
categories: Work
image: /assets/images/post.jpg

---

 

### 理解redis的单线与多线程程操作

IO多路复用程序接收到用户的请求后，全部推送到一个队列里，交给文件分派器。对于后续的操作，基于 Reactor 单线程模式实现， 整个过程都在一个线程里完成，因此 Redis 被称为是单线程的操作

![img](https://img-blog.csdnimg.cn/img_convert/b64cf42106d8fa3719e88b797d427a25.png)

对于单线程的 Redis 来说，基于内存，没有锁的竞争。且命令操作时间复杂度低，因此读写速率是非常快的

Redis 是跑在单线程中的，所有的操作都是按照顺序线性执行的，但是由于读写操作等待用户输入或输出都是阻塞的，所以 I/O 操作在一般情况下往往不能直接返回，这会导致某一文件的 I/O 阻塞导致整个进程无法对其它客户提供服务，而 I/O 多路复用可以解决这个问题。但是对于大键值对这种情况，本身命令执行需要消耗大量时间，这样会阻塞redis主线程的执行，导致redis性能的下降，这种情况应该尽量避免



### Rabbitmq 一个消息并行事务如何实现

> exchange有多个种类，常用的有direct，fanout，topic。前三种类似集合对应关系那样，（direct）1:1,（fanout）1：N,（topic）N:1。direct： 1:1类似完全匹配
>
> fanout：1：N  可以把一个消息并行发布到多个队列上去，简单的说就是，当多个队列绑定到fanout的交换器,那么交换器一次性拷贝多个消息分别发送到绑定的队列上，每个队列有这个消息的副本。
>
> ```
> ps：这个可以在业务上实现并行处理多个任务，比如，用户上传图片功能，当消息到达交换器上，它可以同时路由到积分
> 增加队列和其它队列上，达到并行处理的目的，并且易扩展，以后有什么并行任务的时候，直接绑定到fanout交换器
> 不需求改动之前的代码。
> 复制代码
> ```
>
> topic   N:1 ，多个交换器可以路由消息到同一个队列。根据模糊匹配，比如一个队列的routing key 为*.test ，那么凡是到达交换器的消息中的routing key 后缀.test都被路由到这个队列上

当队列拥有多个消费者时，队列收到的消息将以轮询(负载均衡)的方式发送给消费者。每条消息只会发送给一个订阅的消费者

所以，如果想要将对消息进行并行处理事务 ，需要选择exchange fanout的模式，并且使用多个队列。没有办法通过一个队列多个消费者实现