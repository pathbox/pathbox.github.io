---
layout: post
title: 最近工作总结(50)
date:  2021-07-16 21:00:00
categories: Work
image: /assets/images/post.jpg


---

​    

### 使用hash大幅度提高Redis value内存利用率

如果把要使用的 redis 数据都集中到一起，集中存放，则 value 的大小会远大于 key 和其他内存结构的大小，从而使内存利用率达到 50%~99%。然而此方案也有弊端：如果只想取某个子模块的数据也必须把整体数据都拉下来，无状态化的情况下本来就会频繁读写数据，此方案将显著增加 redis 的CPU压力。
redis 的 hash 类型既可以把数据集中存放，也支持 key 分开读写

### 返回结构体 还是结构体指针

> 1MiB字节以下，返回结构体都更有优势。那返回指针的方式是不是没用了呢？也不是，如果你最终的结构体，就是要存放到堆里，比如要存放到全局的map里，那返回指针优势就更大些，因为其省去了返回结构体时的拷贝操作

返回结构体指针性能会较差的原因是：结构体指针会分配在堆上，分配堆的函数比分配在栈上更复杂，所以更耗时。分配在堆上需要GC来回收

### rz 命令上传文件到跳板机
- 登入跳板机
- 输入 rz命令
- 弹出选择文件框，选择要上传的文件
- 极速上传ing
- It is so COOL!

### 旧版的MySQL字段是字符串类型，传入整数，不会自动转换，能得到数据，但索引会失效，是全表扫描

### 使用redis连接池处理链接是应对高并发的有效方式

当QPS很高的时候，比如10w QPS，如果不使用连接池，会导致大量的短连接请求，对于http请求，会有大量的三次握手和四次挥手，由于在挥手的时候，tcp有time wait 机制，会在1min-2min(根据系统而定)才会完全释放端口给下一个请求使用，所以在time wait时间，会导致端口耗尽，没有课使用的端口，使得短连接请求失败。
解决方法之一，就是加机器，比如加到100台甚至更多，这样能够有足够的端口使用，但这种方式会造成浪费CPU和内存的情况
第二种方式：使用连接池+合适的机器数量，让资源充分合理的使用