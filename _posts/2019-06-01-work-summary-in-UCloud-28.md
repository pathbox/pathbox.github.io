---
layout: post
title: 最近工作总结(28)
date:  2019-06-01 17:00:06
categories: Work
image: /assets/images/post.jpg
---

### 在一个SaaS或PaaS系统中,唯一属性的是company_id(company)

在一个SaaS或PaaS系统中，具有唯一性的应该是company_id，而不是身份证、手机号或邮箱。一个手机号可以属于不同的company。 所以，在设置表的主键时，往往和company_id一起设置为联合主键，这样才是合理的

### 数据库集群同步对业务的一个影响

一个写操作在node2节点， 写入操作之后会调用mq推送给另一个业务，该业务调接口请求得到这个数据，请求的是总库，结果没拿到该数据。是因为，node2节点的数据库同步到总库需要时间，且时间大于业务逻辑请求总库时获取数据的时间，数据还没同步到总库。

解决方案: 请求从库的接口、 使用sleep方法+补充措施

### Redis Cluster or Redis Sentinel
当业务中使用的key的数量达到一定量级或一开始能够预测到会有大量的key存在redis中时，使用Redis Cluster的优势更为明显，会有更好的性能

### 老鼠与毒药问题
问题：有 1000 个一模一样的瓶子，其中有 999 瓶是普通的水，有一瓶是毒药。任何喝下毒药的生物都会在一星期之后死亡。现在，你只有 10 只小白鼠和一星期的时间，如何检验出哪个瓶子里有毒药？

解答：把瓶子从 0 到 999 依次编号，然后全部转换为 10 位二进制数。让第一只老鼠喝掉所有二进制数右起第一位是 1 的瓶子，让第二只老鼠喝掉所有二进制数右起第二位是 1 的瓶子，等等。一星期后，如果第一只老鼠死了，就知道毒药瓶子的二进制编号中，右起第一位是 1 ；如果第二只老鼠没死，就知道毒药瓶子的二进制编号中，右起第二位是 0 ⋯⋯每只老鼠的死活都能确定出 10 位二进制数的其中一位，由此便可知道毒药瓶子的编号了

其实这和信息论有相关的关系，1000转为二进制，大概需要10位。10只老鼠对应每一位，去确定每一位是0/1，最终能够确定出10位的每一位是0/1，从而得到该数值。
